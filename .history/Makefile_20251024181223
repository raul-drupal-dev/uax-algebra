VENV ?= .venv
PYTHON ?= python3
PIP = $(VENV)/bin/pip

.PHONY: venv install serve-local serve-docker serve-docker-build docker-build compose-up compose-down build clean

venv:
	$(PYTHON) -m venv $(VENV)
	@echo "Virtualenv created at $(VENV)"
	$(PIP) install --upgrade pip

install: venv
	$(PIP) install -r requirements.txt

serve-local: install
	@echo "Serving site locally (mkdocs serve) — abre http://127.0.0.1:8000"
	. $(VENV)/bin/activate && mkdocs serve

serve-docker:
	@echo "Serving site with Docker (squidfunk/mkdocs-material) — abre http://127.0.0.1:8000"
	docker run --rm -it -p 8000:8000 -v "$$PWD":/docs squidfunk/mkdocs-material

## Build image from local Dockerfile (instala requirements.txt inside image)
docker-build:
	docker build -t uax-algebra:latest .

## Run the locally built image (uses your mounted files)
serve-docker-build: docker-build
	@echo "Serving site with locally built image uax-algebra:latest — abre http://127.0.0.1:8000"
	docker run --rm -it -p 8000:8000 -v "$$PWD":/docs uax-algebra:latest

## docker-compose helpers
compose-up:
	docker-compose up --build

compose-down:
	docker-compose down

build: install
	. $(VENV)/bin/activate && mkdocs build

clean:
	rm -rf $(VENV) site
